<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>迷你街机 · 在线游戏平台</title>
    <style>
      :root {
        color-scheme: light dark;
        --bg: #060818;
        --panel: rgba(255, 255, 255, 0.06);
        --text: #f4f6fb;
        --text-muted: #9aa4cf;
        --accent: #7dd3fc;
        --accent-2: #c084fc;
        --border: rgba(255, 255, 255, 0.08);
        font-family: "Inter", "HarmonyOS Sans", "PingFang SC", sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background: radial-gradient(circle at top, #0f1730, #04060f 70%);
        color: var(--text);
      }

      header {
        padding: clamp(1.5rem, 5vw, 3rem);
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: flex-end;
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 5vw, 3.5rem);
      }

      header p {
        margin: 0;
        color: var(--text-muted);
        max-width: 540px;
      }

      .controls {
        margin-left: auto;
        display: flex;
        gap: 0.6rem;
        align-items: center;
      }

      .search {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 999px;
        padding: 0.65rem 1.1rem;
        color: var(--text);
        min-width: 230px;
      }

      main {
        padding: 0 clamp(1.5rem, 5vw, 3rem) 3rem;
      }

      .add-game {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid var(--border);
        border-radius: 24px;
        padding: clamp(1rem, 4vw, 1.6rem);
        margin-bottom: 2rem;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      }

      .add-game h2 {
        margin: 0 0 0.4rem;
      }

      .add-game p {
        margin: 0 0 1rem;
        color: var(--text-muted);
      }

      .add-form {
        display: flex;
        flex-wrap: wrap;
        gap: 0.8rem;
      }

      .form-group {
        flex: 1 1 220px;
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
      }

      .form-group label {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .form-group input,
      .form-group textarea {
        border-radius: 14px;
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.04);
        color: var(--text);
        padding: 0.6rem 0.8rem;
        font-family: inherit;
        resize: vertical;
        min-height: 44px;
      }

      .form-group textarea {
        min-height: 80px;
      }

      .add-actions {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        flex-wrap: wrap;
      }

      .add-status {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 1.2rem;
      }

      .card {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border);
        border-radius: 22px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.35);
      }

      .card h2 {
        margin: 0;
        font-size: 1.35rem;
      }

      .meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .tag {
        font-size: 0.75rem;
        padding: 0.25rem 0.7rem;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 999px;
        color: var(--text-muted);
      }

      .actions {
        margin-top: auto;
        display: flex;
        gap: 0.6rem;
      }

      button {
        font-family: inherit;
        border: none;
        cursor: pointer;
        padding: 0.65rem 1rem;
        border-radius: 14px;
        font-weight: 600;
        color: #04060f;
        background: linear-gradient(120deg, var(--accent), var(--accent-2));
        flex: 1;
        transition: transform 0.15s ease;
      }

      button.secondary {
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
      }

      button:active {
        transform: translateY(2px);
      }

      .empty {
        grid-column: 1 / -1;
        text-align: center;
        color: var(--text-muted);
        padding: 3rem 1rem;
        border: 1px dashed var(--border);
        border-radius: 22px;
      }

      .player-overlay {
        position: fixed;
        inset: 0;
        background: rgba(3, 5, 12, 0.92);
        display: none;
        flex-direction: column;
        z-index: 30;
      }

      .player-overlay.active {
        display: flex;
      }

      .player-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      }

      .player-header h3 {
        margin: 0;
      }

      .player-frame {
        flex: 1;
        border: none;
        width: 100%;
        background: #050710;
      }

      .close-btn {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text);
        width: auto;
        padding-inline: 1.2rem;
      }

      .status-bar {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
        color: var(--text-muted);
        border-top: 1px solid rgba(255, 255, 255, 0.08);
      }

      @media (max-width: 600px) {
        .controls {
          width: 100%;
          margin-left: 0;
        }
        .search {
          width: 100%;
        }
        .actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="player-overlay" id="player">
      <div class="player-header">
        <div>
          <h3 id="player-title">正在加载...</h3>
          <small id="player-info" style="color: var(--text-muted)"></small>
        </div>
        <button class="close-btn" id="close-player">关闭</button>
      </div>
      <iframe class="player-frame" id="player-frame" title="Game Player"></iframe>
      <div class="status-bar" id="player-status">准备中...</div>
    </div>

    <header>
      <div>
        <h1>迷你街机</h1>
        <p>集中管理所有 HTML 小游戏，一键运行、分享或扩展。向列表增加新条目即可上架到 GitHub Pages。</p>
      </div>
      <div class="controls">
        <input class="search" id="search" type="search" placeholder="搜索游戏 / 标签" />
      </div>
    </header>

    <main>
      <section class="add-game" aria-label="新增自定义游戏">
        <h2>自定义游戏</h2>
        <p>填写标题、简介、标签与 HTML 路径（可为完整 URL），即可把个人游戏加入列表，仅在当前浏览器保存。</p>
        <form class="add-form" id="add-game-form">
          <div class="form-group">
            <label for="game-title">游戏标题 *</label>
            <input id="game-title" type="text" required placeholder="例如：My Puzzle" />
          </div>
          <div class="form-group">
            <label for="game-file">文件 / URL *</label>
            <input id="game-file" type="text" required placeholder="typing-game.html 或 https://..." />
          </div>
          <div class="form-group">
            <label for="game-tags">标签（逗号分隔，可选）</label>
            <input id="game-tags" type="text" placeholder="挑战, 益智" />
          </div>
          <div class="form-group" style="flex-basis:100%">
            <label for="game-desc">简介（可选）</label>
            <textarea id="game-desc" placeholder="一句话描述玩法"></textarea>
          </div>
          <div class="add-actions">
            <button type="submit" style="flex:0 0 auto; padding-inline:1.4rem">加入列表</button>
            <span class="add-status" id="add-status">数据仅保存于本地浏览器。</span>
          </div>
        </form>
      </section>
      <div class="grid" id="grid"></div>
    </main>

    <script>
      const baseGames = [
        {
          id: "jumping-ball-runner",
          title: "Jumping Ball Runner",
          description: "节奏向的无尽奔跑，飞跃障碍追逐高分。",
          tags: ["平台", "街机"],
          file: "jumping-ball-runner.html",
        },
        {
          id: "lofi-visualiser",
          title: "Lo-Fi Visualiser",
          description: "可交互的音乐可视化仪表盘，内置氛围音。",
          tags: ["可视化", "音乐"],
          file: "lofi-visualiser.html",
        },
        {
          id: "mario-kart",
          title: "Mini Kart Dash",
          description: "三车道漂移闪避香蕉，冲刺最佳成绩。",
          tags: ["竞速", "动作"],
          file: "mario-kart.html",
        },
        {
          id: "retro-pixel-painter",
          title: "Retro Pixel Painter",
          description: "像素画创作工具，支持选区、撤销与导出。",
          tags: ["工具", "像素"],
          file: "retro-pixel-painter.html",
        },
        {
          id: "typing-speed-race",
          title: "Typing Speed Race",
          description: "限时打字比赛，记录历史成绩曲线。",
          tags: ["文字", "挑战"],
          file: "typing-speed-race.html",
        },
        {
          id: "virtual-drum-kit",
          title: "Virtual Drum Kit",
          description: "十二键虚拟鼓垫，可录制和回放节奏。",
          tags: ["音乐", "节奏"],
          file: "virtual-drum-kit.html",
        },
      ];

      const STORAGE_KEY = "mini-arcade-custom-games";
      let customGames = [];

      const grid = document.getElementById("grid");
      const searchInput = document.getElementById("search");
      const playerOverlay = document.getElementById("player");
      const playerFrame = document.getElementById("player-frame");
      const playerTitle = document.getElementById("player-title");
      const playerInfo = document.getElementById("player-info");
      const playerStatus = document.getElementById("player-status");
      const closePlayerBtn = document.getElementById("close-player");
      const addGameForm = document.getElementById("add-game-form");
      const addStatus = document.getElementById("add-status");
      const titleInput = document.getElementById("game-title");
      const fileInput = document.getElementById("game-file");
      const tagsInput = document.getElementById("game-tags");
      const descInput = document.getElementById("game-desc");

      const getAllGames = () => [...baseGames, ...customGames];

      const loadCustomGames = () => {
        try {
          const stored = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
          if (Array.isArray(stored)) {
            customGames = stored;
          }
        } catch (err) {
          console.warn("无法读取自定义游戏", err);
          customGames = [];
        }
      };

      const persistCustomGames = () => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(customGames));
      };

      function createCard(game) {
        const card = document.createElement("article");
        card.className = "card";
        const header = document.createElement("div");
        const titleEl = document.createElement("h2");
        titleEl.textContent = game.title;
        const descEl = document.createElement("p");
        descEl.style.margin = "0";
        descEl.style.color = "var(--text-muted)";
        descEl.textContent = game.description || "暂无简介";
        header.append(titleEl, descEl);

        const meta = document.createElement("div");
        meta.className = "meta";
        const displayTags = [...(game.tags || [])];
        if (game.custom) displayTags.push("自定义");
        displayTags.forEach((tag) => {
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = tag;
          meta.appendChild(span);
        });

        const actions = document.createElement("div");
        actions.className = "actions";
        const playBtn = document.createElement("button");
        playBtn.textContent = "运行";
        playBtn.addEventListener("click", () => openPlayer(game));
        const openBtn = document.createElement("button");
        openBtn.className = "secondary";
        openBtn.textContent = "新标签";
        openBtn.addEventListener("click", () => {
          window.open(game.file, "_blank", "noopener");
        });
        actions.append(playBtn, openBtn);

        card.append(header);
        if (displayTags.length) {
          card.append(meta);
        }
        card.append(actions);
        return card;
      }

      function renderGrid(keyword = "") {
        const term = keyword.trim().toLowerCase();
        const catalog = getAllGames();
        const list = term
          ? catalog.filter((game) => {
              const desc = (game.description || "").toLowerCase();
              const title = (game.title || "").toLowerCase();
              const tags = (game.tags || []).map((tag) => tag.toLowerCase());
              return (
                title.includes(term) ||
                desc.includes(term) ||
                tags.some((tag) => tag.includes(term))
              );
            })
          : catalog;

        grid.innerHTML = "";
        if (!list.length) {
          const empty = document.createElement("div");
          empty.className = "empty";
          empty.textContent = "没有匹配的游戏，尝试其他关键词。";
          grid.appendChild(empty);
          return;
        }
        list.forEach((game) => grid.appendChild(createCard(game)));
      }

      function openPlayer(game) {
        playerTitle.textContent = game.title;
        const tagList = game.tags && game.tags.length ? [...game.tags] : [];
        if (game.custom) tagList.push("自定义");
        const tagInfo = tagList.length ? tagList.join(" · ") : "街机合集";
        playerInfo.textContent = `${tagInfo} · ${game.file}`;
        playerStatus.textContent = "正在加载...";
        playerFrame.src = game.file;
        playerFrame.onload = () => (playerStatus.textContent = "加载完成，祝你玩得开心！");
        playerOverlay.classList.add("active");
      }

      function closePlayer() {
        playerFrame.src = "about:blank";
        playerOverlay.classList.remove("active");
      }

      function normalizeTags(value) {
        return value
          .split(/[,，]/)
          .map((tag) => tag.trim())
          .filter(Boolean);
      }

      function showStatus(message, isError = false) {
        addStatus.textContent = message;
        addStatus.style.color = isError ? "#fbbf24" : "var(--text-muted)";
        if (!isError) {
          setTimeout(() => {
            addStatus.textContent = "数据仅保存于本地浏览器。";
            addStatus.style.color = "var(--text-muted)";
          }, 3000);
        }
      }

      addGameForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const title = titleInput.value.trim();
        const file = fileInput.value.trim();
        if (!title || !file) {
          showStatus("标题和文件为必填项。", true);
          return;
        }
        const description = descInput.value.trim();
        const tags = normalizeTags(tagsInput.value || "");
        const newGame = {
          id: `custom-${Date.now()}`,
          title,
          description,
          tags,
          file,
          custom: true,
        };
        customGames.push(newGame);
        persistCustomGames();
        renderGrid(searchInput.value);
        addGameForm.reset();
        showStatus("已添加到列表，刷新仍会保留。");
      });

      searchInput.addEventListener("input", (e) => renderGrid(e.target.value));
      closePlayerBtn.addEventListener("click", closePlayer);
      playerOverlay.addEventListener("click", (e) => {
        if (e.target === playerOverlay) closePlayer();
      });

      loadCustomGames();
      renderGrid();
    </script>
  </body>
</html>
